-- TABLAS BASE

create table personas (
                          id bigint generated by default as identity primary key,
                          nombre varchar(255) not null,
                          apellido varchar(255) not null,
                          correo varchar(255) not null,
                          clave varchar(255) not null
);

create table usuarios (
                          id bigint not null primary key
);

create table administradores (
                                 id bigint not null primary key
);

create table categorias (
                            id bigint generated by default as identity primary key,
                            nombre varchar(255) not null,
                            descripcion varchar(255) not null
);

create table articulos (
                           id bigint generated by default as identity primary key,
                           nombre varchar(255) not null,
                           descripcion varchar(255),
                           estado varchar(255) not null check (estado in (
                                                                          'DISPONIBLE',
                                                                          'EN_NEGOCIACION',
                                                                          'INTERCAMBIADO',
                                                                          'DESACTIVADO'
                               )),
                           ruta_imagen varchar(255),
                           id_categoria bigint unique,
                           id_usuario bigint
);

create table intercambios (
                              id bigint generated by default as identity primary key,
                              fecha timestamp,
                              estado varchar(255) not null check (estado in (
                                                                             'SOLICITADO',
                                                                             'ACEPTADO',
                                                                             'REALIZADO',
                                                                             'EN_NEGOCIACION',
                                                                             'RECHAZADO',
                                                                             'CANCELADO'
                                  )),
                              id_articulo_uno bigint not null unique,
                              id_articulo_dos bigint not null unique,
                              id_usuario_uno bigint not null,
                              id_usuario_dos bigint not null
);

create table reportes (
                          id bigint generated by default as identity primary key,
                          fecha_reporte timestamp not null,
                          descripcion varchar(255) not null,
                          estado varchar(255) not null check (estado in (
                                                                         'ACTIVO',
                                                                         'EN_REVISION',
                                                                         'RESUELTO',
                                                                         'DESCARTADO'
                              )),
                          id_articulo bigint,
                          id_usuario bigint unique
);

create table administradores_reportes_activos (
                                                  id_administrador bigint not null,
                                                  id_reporte bigint not null unique
);

create table resenhas (
                          id bigint generated by default as identity primary key,
                          puntuacion integer check (puntuacion between 1 and 5),
                          descripcion varchar(255) not null,
                          id_autor bigint unique,
                          id_intercambio bigint not null
);

-- RELACIONES (FOREIGN KEYS)

alter table administradores
    add constraint fk_admin_persona
        foreign key (id) references personas;

alter table usuarios
    add constraint fk_usuario_persona
        foreign key (id) references personas;

alter table articulos
    add constraint fk_articulo_categoria
        foreign key (id_categoria) references categorias;

alter table articulos
    add constraint fk_articulo_usuario
        foreign key (id_usuario) references usuarios;

alter table intercambios
    add constraint fk_intercambio_articulo_uno
        foreign key (id_articulo_uno) references articulos;

alter table intercambios
    add constraint fk_intercambio_articulo_dos
        foreign key (id_articulo_dos) references articulos;

alter table intercambios
    add constraint fk_intercambio_usuario_uno
        foreign key (id_usuario_uno) references usuarios;

alter table intercambios
    add constraint fk_intercambio_usuario_dos
        foreign key (id_usuario_dos) references usuarios;

alter table reportes
    add constraint fk_reporte_articulo
        foreign key (id_articulo) references articulos;

alter table reportes
    add constraint fk_reporte_usuario
        foreign key (id_usuario) references usuarios;

alter table administradores_reportes_activos
    add constraint fk_admin_reporte_admin
        foreign key (id_administrador) references administradores;

alter table administradores_reportes_activos
    add constraint fk_admin_reporte_reporte
        foreign key (id_reporte) references reportes;

alter table resenhas
    add constraint fk_resenha_autor
        foreign key (id_autor) references usuarios;

alter table resenhas
    add constraint fk_resenha_intercambio
        foreign key (id_intercambio) references intercambios;
